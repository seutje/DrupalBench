[
  {
    "title": "Refactor SDC Media Card to use ContextualLinksSerializer service",
    "prompt": "<h2>Problem/Motivation</h2>\n<p>The <code>sdc_media</code> module provides a <strong>Single Directory Component (SDC)</strong> for rendering media cards. To ensure a seamless editor experience, the component includes contextual links. However, the current implementation in the module's preprocess function uses the deprecated <code>_contextual_links_to_id()</code> and <code>_contextual_id_to_links()</code> functions.</p>\n<p>As per the Drupal 11 change record <a href=\"https://www.drupal.org/node/3568088\">\"The _contextual_links_to_id() &amp; _contextual_id_to_links() functions are deprecated\"</a>, these should be replaced with the <code>Drupal\\contextual\\ContextualLinksSerializer</code> service.</p>\n\n<h2>Proposed resolution</h2>\n<ul>\n  <li>Update <code>sdc_media_preprocess_card()</code> to use the <code>contextual.serializer</code> service instead of the deprecated global functions.</li>\n  <li>Ensure the service is called using the <code>ContextualLinksSerializer::class</code> identifier for modern Drupal 11 standards.</li>\n  <li>Maintain the existing logic that passes the contextual ID to the SDC's <code>title_suffix</code>.</li>\n</ul>\n\n<h2>Remaining tasks</h2>\n<ul>\n  <li>Refactor <code>sdc_media.module</code> to use the service.</li>\n  <li>Import the <code>Drupal\\contextual\\ContextualLinksSerializer</code> class.</li>\n</ul>",
    "ground_truth": "diff --git a/sdc_media.module b/sdc_media.module\nindex 1234567..89abcde 100644\n--- a/sdc_media.module\n+++ b/sdc_media.module\n@@ -2,11 +2,15 @@\n \n /**\n  * @file\n- * Provides SDC media component integration.\n+ * Provides Single Directory Component (SDC) media integration.\n  */\n \n+use Drupal\\contextual\\ContextualLinksSerializer;\n+\n /**\n  * Implements hook_preprocess_HOOK() for the 'card' SDC component.\n  */\n function sdc_media_preprocess_card(&$variables) {\n   if (!empty($variables['contextual_links'])) {\n+    /** @var \\Drupal\\contextual\\ContextualLinksSerializer $serializer */\n+    $serializer = \\Drupal::service(ContextualLinksSerializer::class);\n+\n     $variables['title_suffix']['contextual_links'] = [\n       '#type' => 'contextual_links_placeholder',\n-      '#id' => _contextual_links_to_id($variables['contextual_links']),\n+      '#id' => $serializer->linksToId($variables['contextual_links']),\n     ];\n   }\n }\n",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3568088"
  },
  {
    "title": "Implement static menu link overrides using Drupal Recipes API",
    "prompt": "<h2>Problem/Motivation</h2>\n<p>Drupal 11 introduced a new config action for the <code>core.menu.static_menu_link_overrides</code> configuration entity. This allows developers to programmatically override properties of menu links defined in <code>*.links.menu.yml</code> files, such as their weight and enabled status, without needing custom PHP code or manual database changes.</p>\n<p>A client wants a \"Simplified Admin Experience\" recipe. They require that the default \"Help\" link (<code>help.main</code>) provided by the Help module be disabled, and the \"Contact\" page link (<code>contact.site_page</code>) from the Contact module be moved to a prominent position (weight -10) in the navigation.</p>\n\n<h2>Proposed resolution</h2>\n<p>Create a new recipe named <code>simplified_navigation</code> that uses the <code>overrideMenuLinks</code> configuration action. The recipe should target the <code>core.menu.static_menu_link_overrides</code> configuration and apply the requested overrides to <code>help.main</code> and <code>contact.site_page</code>.</p>\n\n<h2>Remaining tasks</h2>\n<ol>\n  <li>Create the <code>recipes/simplified_navigation/recipe.yml</code> file.</li>\n  <li>Define the metadata for the recipe.</li>\n  <li>Apply the <code>config: actions:</code> block to use the <code>overrideMenuLinks</code> action.</li>\n</ol>",
    "ground_truth": "diff --git a/recipes/simplified_navigation/recipe.yml b/recipes/simplified_navigation/recipe.yml\nnew file mode 100644\n--- /dev/null\n+++ b/recipes/simplified_navigation/recipe.yml\n@@ -0,0 +1,14 @@\n+name: 'Simplified Navigation'\n+description: 'Disables the Help link and reorders the Contact link using static menu link overrides.'\n+type: 'Site'\n+install:\n+  - help\n+  - contact\n+config:\n+  actions:\n+    core.menu.static_menu_link_overrides:\n+      overrideMenuLinks:\n+        help.main:\n+          enabled: false\n+        contact.site_page:\n+          weight: -10",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3570506"
  },
  {
    "title": "Implement Asset Threshold-Aware Access Policy and SDC Component",
    "prompt": "<h3>Problem/Motivation</h3><p>With the release of Drupal 11 (Change Record <a href='https://www.drupal.org/node/3557835'>3557835</a>), a new <code>$settings['asset_gc_threshold']</code> has been introduced to manage the retention of asset aggregates. In development environments, this threshold is often set to <code>0</code> to ensure all aggregates are cleared immediately. We need a way to dynamically grant the <code>administer site configuration</code> permission to users with a specific role only when the site is in this 'Asset Development Mode' (threshold set to 0), and provide a UI component to display this status.</p><h3>Proposed resolution</h3><ul><li>Create a new module <code>asset_gc_manager</code>.</li><li>Implement an <strong>Access Policy</strong> using the <code>AccessPolicyInterface</code> that grants the <code>administer site configuration</code> permission if <code>$settings['asset_gc_threshold']</code> is <code>0</code>.</li><li>Create a <strong>Single Directory Component (SDC)</strong> named <code>threshold-status</code> that displays whether asset garbage collection is in 'Development' or 'Production' mode.</li><li>Ensure the Access Policy correctly implements <code>calculatePermissions</code> and <code>getPersistentCacheContexts</code>.</li><li>Use PHP 8.3 standards, including strict typing and constructor promotion.</li></ul><h3>Remaining tasks</h3><ul><li>Define the module and service.</li><li>Implement the Access Policy logic.</li><li>Create the SDC twig and YAML files in the correct directory structure.</li></ul>",
    "ground_truth": "diff --git a/modules/custom/asset_gc_manager/asset_gc_manager.info.yml b/modules/custom/asset_gc_manager/asset_gc_manager.info.yml\nnew file mode 100644\n--- /dev/null\n+++ b/modules/custom/asset_gc_manager/asset_gc_manager.info.yml\n@@ -0,0 +1,6 @@\n+name: 'Asset GC Manager'\n+type: module\n+description: 'Manages asset GC visibility and access policies.'\n+core_version_requirement: ^11\n+dependencies:\n+  - drupal:sdc\ndiff --git a/modules/custom/asset_gc_manager/asset_gc_manager.services.yml b/modules/custom/asset_gc_manager/asset_gc_manager.services.yml\nnew file mode 100644\n--- /dev/null\n+++ b/modules/custom/asset_gc_manager/asset_gc_manager.services.yml\n@@ -0,0 +1,6 @@\n+services:\n+  asset_gc_manager.access_policy:\n+    class: Drupal\\asset_gc_manager\\Access\\AssetThresholdAccessPolicy\n+    tags:\n+      - { name: access_policy }\ndiff --git a/modules/custom/asset_gc_manager/components/threshold-status/threshold-status.component.yml b/modules/custom/asset_gc_manager/components/threshold-status/threshold-status.component.yml\nnew file mode 100644\n--- /dev/null\n+++ b/modules/custom/asset_gc_manager/components/threshold-status/threshold-status.component.yml\n@@ -0,0 +1,9 @@\n+name: Threshold Status\n+description: Displays the current asset garbage collection mode.\n+props:\n+  type: object\n+  properties:\n+    is_dev_mode:\n+      type: boolean\n+      title: Development Mode\n+    threshold_days:\n+      type: integer\ndiff --git a/modules/custom/asset_gc_manager/components/threshold-status/threshold-status.twig b/modules/custom/asset_gc_manager/components/threshold-status/threshold-status.twig\nnew file mode 100644\n--- /dev/null\n+++ b/modules/custom/asset_gc_manager/components/threshold-status/threshold-status.twig\n@@ -0,0 +1,8 @@\n+<div class=\"asset-gc-status\">\n+  <strong>Asset GC Mode:</strong>\n+  {% if is_dev_mode %}\n+    <span class=\"badge badge--warning\">Development (Threshold: {{ threshold_days }} days)</span>\n+  {% else %}\n+    <span class=\"badge badge--success\">Production (Threshold: {{ threshold_days }} days)</span>\n+  {% endif %}\n+</div>\ndiff --git a/modules/custom/asset_gc_manager/src/Access/AssetThresholdAccessPolicy.php b/modules/custom/asset_gc_manager/src/Access/AssetThresholdAccessPolicy.php\nnew file mode 100644\n--- /dev/null\n+++ b/modules/custom/asset_gc_manager/src/Access/AssetThresholdAccessPolicy.php\n@@ -0,0 +1,48 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+namespace Drupal\\asset_gc_manager\\Access;\n+\n+use Drupal\\Core\\Access\\AccessPolicyInterface;\n+use Drupal\\Core\\Access\\CalculatedPermissionsInterface;\n+use Drupal\\Core\\Access\\RefinableRequiredPermissions;\n+use Drupal\\Core\\Session\\AccountInterface;\n+use Drupal\\Core\\Site\\Settings;\n+\n+/**\n+ * Grants administrative permissions if the asset GC threshold is set to 0.\n+ */\n+final readonly class AssetThresholdAccessPolicy implements AccessPolicyInterface {\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function applies(string $scope): bool {\n+    return $scope === AccessPolicyInterface::SCOPE_DRUPAL;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function calculatePermissions(AccountInterface $account, string $scope): CalculatedPermissionsInterface {\n+    $calculated_permissions = new RefinableRequiredPermissions();\n+\n+    // The new Drupal 11 setting: asset_gc_threshold.\n+    $threshold = Settings::get('asset_gc_threshold', 45);\n+\n+    if ($threshold === 0) {\n+      $calculated_permissions->addPermission('administer site configuration');\n+    }\n+\n+    return $calculated_permissions;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function getPersistentCacheContexts(): array {\n+    // This policy's results do not depend on the user account, only global settings.\n+    return [];\n+  }\n+\n+}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3557835"
  }
]