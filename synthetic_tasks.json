[
  {
    "title": "Refactor NewsCardBlock to use ContextualLinksSerializer for SDC contextual links",
    "prompt": "<h1>Problem/Motivation</h1>\n<p>In Drupal 11, the procedural functions <code>_contextual_links_to_id()</code> and <code>_contextual_id_to_links()</code> have been deprecated as per the Change Record <a href=\"https://www.drupal.org/node/3568088\">The _contextual_links_to_id() &amp; _contextual_id_to_links() functions are deprecated</a>. Their functionality has been migrated to the <code>Drupal\\contextual\\ContextualLinksSerializer</code> service.</p>\n<p>Our custom module <code>news_display</code> provides a Single Directory Component (SDC) named <code>card</code>, which is rendered via the <code>NewsCardBlock</code> block plugin. The block currently uses the deprecated procedural function <code>_contextual_links_to_id()</code> to generate the <code>#id</code> for contextual links placeholders. This needs to be refactored to use modern dependency injection and the new serializer service.</p>\n\n<h1>Proposed resolution</h1>\n<ul>\n  <li>Update <code>NewsCardBlock.php</code> to implement <code>ContainerFactoryPluginInterface</code>.</li>\n  <li>Inject the <code>contextual.serializer</code> service into the block plugin.</li>\n  <li>Replace the call to <code>_contextual_links_to_id()</code> with the <code>linksToId()</code> method from the injected service.</li>\n</ul>\n\n<h1>Remaining tasks</h1>\n<ol>\n  <li>Modify the <code>NewsCardBlock</code> class to support dependency injection.</li>\n  <li>Update the <code>build()</code> method to use the new service.</li>\n  <li>Verify that the contextual links are still correctly generated using a Kernel test.</li>\n</ol>",
    "ground_truth": "--- a/web/modules/custom/news_display/src/Plugin/Block/NewsCardBlock.php\n+++ b/web/modules/custom/news_display/src/Plugin/Block/NewsCardBlock.php\n@@ -2,18 +2,50 @@\n \n namespace Drupal\\news_display\\Plugin\\Block;\n \n use Drupal\\Core\\Block\\BlockBase;\n+use Drupal\\contextual\\ContextualLinksSerializer;\n+use Drupal\\Core\\Plugin\\ContainerFactoryPluginInterface;\n+use Symfony\\Component\\DependencyInjection\\ContainerInterface;\n \n /**\n  * Provides a 'News Card' block.\n  *\n  * @Block(\n  *   id = \"news_card_block\",\n  *   admin_label = @Translation(\"News Card\"),\n  * )\n  */\n-class NewsCardBlock extends BlockBase {\n+class NewsCardBlock extends BlockBase implements ContainerFactoryPluginInterface {\n+\n+  /**\n+   * The contextual links serializer.\n+   *\n+   * @var \\Drupal\\contextual\\ContextualLinksSerializer\n+   */\n+  protected $contextualLinksSerializer;\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function __construct(array $configuration, $plugin_id, $plugin_definition, ContextualLinksSerializer $serializer) {\n+    parent::__construct($configuration, $plugin_id, $plugin_definition);\n+    $this->contextualLinksSerializer = $serializer;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {\n+    return new static(\n+      $configuration,\n+      $plugin_id,\n+      $plugin_definition,\n+      $container->get(ContextualLinksSerializer::class)\n+    );\n+  }\n \n   public function build() {\n     $links = [\n       'news_display' => [\n         'route_parameters' => ['node' => 1],\n       ],\n     ];\n \n     return [\n       '#type' => 'component',\n       '#component' => 'news_display:card',\n+      '#props' => [\n+        'title' => $this->t('News Card'),\n+      ],\n       '#title_suffix' => [\n         'contextual_links' => [\n           '#type' => 'contextual_links_placeholder',\n-          '#id' => _contextual_links_to_id($links),\n+          '#id' => $this->contextualLinksSerializer->linksToId($links),\n         ],\n       ],\n     ];\n   }\n }",
    "test_path": "web/modules/custom/news_display/tests/src/Kernel/NewsCardBlockTest.php",
    "test_content": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\Tests\\news_display\\Kernel;\n\nuse Drupal\\KernelTests\\KernelTestBase;\nuse Drupal\\contextual\\ContextualLinksSerializer;\n\n/**\n * Tests the News Card block contextual links serialization.\n *\n * @group news_display\n */\nclass NewsCardBlockTest extends KernelTestBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static $modules = [\n    'system',\n    'user',\n    'contextual',\n    'news_display',\n  ];\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function setUp(): void {\n    parent::setUp();\n    $this->installEntitySchema('user');\n  }\n\n  /**\n   * Tests that the block uses the serializer service correctly.\n   */\n  public function testBlockContextualLinksId(): void {\n    $block_manager = $this->container->get('plugin.manager.block');\n    /** @var \\Drupal\\news_display\\Plugin\\Block\\NewsCardBlock $block */\n    $block = $block_manager->createInstance('news_card_block', []);\n\n    $build = $block->build();\n\n    $this->assertArrayHasKey('contextual_links', $build['#title_suffix']);\n    \n    $links = [\n      'news_display' => [\n        'route_parameters' => ['node' => 1],\n      ],\n    ];\n    \n    // Validate that the ID generated in the build array matches the one from the service.\n    $serializer = $this->container->get(ContextualLinksSerializer::class);\n    $expected_id = $serializer->linksToId($links);\n\n    $this->assertEquals($expected_id, $build['#title_suffix']['contextual_links']['#id']);\n    $this->assertEquals('contextual_links_placeholder', $build['#title_suffix']['contextual_links']['#type']);\n  }\n}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3568088"
  },
  {
    "title": "Implement static menu link overrides in a Drupal Recipe",
    "prompt": "<h3>Problem/Motivation</h3><p>Drupal 11 has introduced a new config action for the <code>core.menu.static_menu_link_overrides</code> configuration entity. This allows recipes to programmatically override properties of static menu links (links defined in <code>*.links.menu.yml</code> files), such as their <code>weight</code>, <code>enabled</code> status, or <code>parent</code>.</p><p>Previously, recipes could not easily modify static menu links without providing custom code or complex configuration imports. With the new <code>overrideMenuLinks</code> action, this is now possible via declarative YAML in a recipe.</p><h3>Proposed resolution</h3><p>Create a new recipe named <code>custom_navigation</code> that performs the following actions:</p><ul><li>Installs the <code>contact</code> and <code>search</code> modules.</li><li>Uses the <code>overrideMenuLinks</code> config action to disable the 'Search' link (<code>search.view</code>).</li><li>Uses the <code>overrideMenuLinks</code> config action to change the weight of the 'Contact' link (<code>contact.site_page</code>) to <code>100</code>.</li></ul><h3>Remaining tasks</h3><ol><li>Create the <code>web/recipes/custom_navigation/recipe.yml</code> file.</li><li>Implement a kernel test to verify that applying the recipe correctly updates the static menu link overrides.</li></ol>",
    "ground_truth": "diff --git a/web/recipes/custom_navigation/recipe.yml b/web/recipes/custom_navigation/recipe.yml\nnew file mode 100644\nindex 0000000..8a4e5d6\n--- /dev/null\n+++ b/web/recipes/custom_navigation/recipe.yml\n@@ -0,0 +1,13 @@\n+name: 'Custom Navigation'\n+type: 'recipe'\n+description: 'Overrides static menu links for search and contact.'\n+install:\n+  - contact\n+  - search\n+config:\n+  actions:\n+    core.menu.static_menu_link_overrides:\n+      overrideMenuLinks:\n+        search.view:\n+          enabled: false\n+        contact.site_page:\n+          weight: 100",
    "test_path": "web/core/tests/Drupal/KernelTests/Core/Recipe/StaticMenuLinkOverrideRecipeTest.php",
    "test_content": "<?php\n\nnamespace Drupal\\KernelTests\\Core\\Recipe;\n\nuse Drupal\\Core\\Config\\ConfigFactoryInterface;\n\nuse Drupal\\Core\\Recipe\\Recipe;\nuse Drupal\\Core\\Recipe\\RecipeRunner;\nuse Drupal\\KernelTests\\KernelTestBase;\nuse Symfony\\Component\\Filesystem\\Filesystem;\n\n/**\n * Tests the overrideMenuLinks config action within a recipe.\n *\n * @group Recipe\n */\nclass StaticMenuLinkOverrideRecipeTest extends KernelTestBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static $modules = [\n    'system',\n    'user',\n    'contact',\n    'search',\n  ];\n\n  /**\n   * The recipe directory.\n   *\n   * @var string\n   */\n  protected string $recipeDir;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function setUp(): void {\n    parent::setUp();\n\n    $this->installConfig(['system', 'contact', 'search']);\n\n    // Create a temporary recipe directory.\n    $this->recipeDir = $this->siteDirectory . '/recipes/custom_navigation';\n    (new Filesystem())->mkdir($this->recipeDir);\n  }\n\n  /**\n   * Tests that the recipe correctly overrides static menu links.\n   */\n  public function testStaticMenuLinkOverride(): void {\n    $recipe_yaml = <<<'YAML'\nname: 'Custom Navigation'\ntype: 'recipe'\ninstall:\n  - contact\n  - search\nconfig:\n  actions:\n    core.menu.static_menu_link_overrides:\n      overrideMenuLinks:\n        search.view:\n          enabled: false\n        contact.site_page:\n          weight: 100\nYAML;\n\n    file_put_contents($this->recipeDir . '/recipe.yml', $recipe_yaml);\n\n    $recipe = Recipe::createFromDirectory($this->recipeDir);\n    RecipeRunner::processRecipe($recipe);\n\n    /** @var \\Drupal\\Core\\Config\\ConfigFactoryInterface $config_factory */\n    $config_factory = $this->container->get('config.factory');\n    $overrides = $config_factory->get('core.menu.static_menu_link_overrides')->get('definitions');\n\n    // Verify search.view is disabled.\n    $this->assertArrayHasKey('search.view', $overrides);\n    $this->assertFalse($overrides['search.view']['enabled']);\n\n    // Verify contact.site_page weight is 100.\n    $this->assertArrayHasKey('contact.site_page', $overrides);\n    $this->assertEquals(100, $overrides['contact.site_page']['weight']);\n\n    // Verify that the menu link manager reflects these changes.\n    /** @var \\Drupal\\Core\\Menu\\MenuLinkManagerInterface $menu_link_manager */\n    $menu_link_manager = $this->container->get('plugin.manager.menu.link');\n    \n    $search_link = $menu_link_manager->getDefinition('search.view');\n    $this->assertEquals(0, $search_link['enabled']);\n\n    $contact_link = $menu_link_manager->getDefinition('contact.site_page');\n    $this->assertEquals(100, $contact_link['weight']);\n  }\n\n}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3570506"
  },
  {
    "title": "Implement time-based garbage collection for asset aggregates",
    "prompt": "<h1>Problem/Motivation</h1><p>Currently, Drupal deletes all CSS and JavaScript aggregate files whenever caches are cleared. This behavior causes several performance issues:</p><ul><li>CDNs and browser caches are invalidated immediately, leading to a spike in origin traffic.</li><li>The web server must immediately spend resources regenerating the same aggregates.</li><li>Users experience slower page loads after a cache clear.</li></ul><p>A new approach is needed where aggregate files are only deleted if they are older than a specific threshold, allowing existing aggregates to be reused if the source files haven't changed.</p><h1>Proposed resolution</h1><p>Introduce a new setting <code>$settings['asset_gc_threshold']</code> in <code>settings.php</code> with a default value of 45 days (3,888,000 seconds). Update <code>AssetDumper::deleteAll()</code> to only delete files within the asset directories that have a modification time (mtime) older than this threshold.</p><h1>Remaining tasks</h1><ul><li>Modify <code>Drupal\\Core\\Asset\\AssetDumper</code> to respect the garbage collection threshold.</li><li>Ensure the default threshold is 45 days.</li><li>Provide a way to set the threshold to 0 to maintain legacy behavior (immediate deletion) for development environments.</li></ul>",
    "ground_truth": "--- a/web/core/lib/Drupal/Core/Asset/AssetDumper.php\n+++ b/web/core/lib/Drupal/Core/Asset/AssetDumper.php\n@@ -2,6 +2,7 @@\n \n namespace Drupal\\Core\\Asset;\n \n+use Drupal\\Core\\Site\\Settings;\n use Drupal\\Component\\Utility\\Crypt;\n use Drupal\\Core\\File\\FileSystemInterface;\n \n@@ -58,7 +59,16 @@\n   public function deleteAll($extension = NULL) {\n     $directory = 'public://' . $extension;\n     if ($this->fileSystem\\->prepareDirectory($directory, FileSystemInterface::MODIFY_PERMISSIONS)) {\n-      $this->fileSystem\\->scanDirectory($directory, '/.*/', ['callback' => [$this->fileSystem, 'delete']]);\n+      $threshold = Settings::get('asset_gc_threshold', 3888000);\n+      $files = $this->fileSystem\\->scanDirectory($directory, '/.*/');\n+      $now = time();\n+      foreach ($files as $file) {\n+        if ($now - filemtime($file->uri) > $threshold) {\n+          $this->fileSystem\\->delete($file->uri);\n+        }\n+      }\n     }\n   }\n \n",
    "test_path": "web/core/tests/Drupal/KernelTests/Core/Asset/AssetDumperGcTest.php",
    "test_content": "<?php\n\ndeclare(strict_types=1);\n\nnamespace Drupal\\KernelTests\\Core\\Asset;\n\nuse Drupal\\Core\\Asset\\AssetDumper;\nuse Drupal\\Core\\File\\FileSystemInterface;\nuse Drupal\\Core\\Site\\Settings;\nuse Drupal\\KernelTests\\KernelTestBase;\nuse PHPUnit\\Framework\\Attributes\\Test;\nuse PHPUnit\\Framework\\Attributes\\CoversClass;\n\n/**\n * Tests asset garbage collection.\n */\n#[CoversClass(AssetDumper::class)]\nclass AssetDumperGcTest extends KernelTestBase {\n\n  /**\n   * The asset dumper under test.\n   */\n  protected AssetDumper $assetDumper;\n\n  /**\n   * The file system service.\n   */\n  protected FileSystemInterface $fileSystem;\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function setUp(): void {\n    parent::setUp();\n    $this->fileSystem = $this->container->get('file_system');\n    $this->assetDumper = new AssetDumper($this->fileSystem);\n  }\n\n  /**\n   * Tests that only files older than the threshold are deleted.\n   */\n  #[Test]\n  public function testDeleteAllWithThreshold(): void {\n    $directory = 'public://css';\n    $this->fileSystem->prepareDirectory($directory, FileSystemInterface::CREATE_DIRECTORY);\n\n    $old_file = $directory . '/old.css';\n    $new_file = $directory . '/new.css';\n\n    file_put_contents($old_file, 'body { color: red; }');\n    file_put_contents($new_file, 'body { color: blue; }');\n\n    // Set mtime: old file 60 days ago, new file now.\n    $sixty_days_ago = time() - (60 * 24 * 60 * 60);\n    touch($this->fileSystem->realpath($old_file), $sixty_days_ago);\n    touch($this->fileSystem->realpath($new_file), time());\n\n    // Default threshold is 45 days. old.css should be deleted, new.css stays.\n    $this->assetDumper->deleteAll('css');\n\n    $this->assertFileDoesNotExist($old_file);\n    $this->assertFileExists($new_file);\n  }\n\n  /**\n   * Tests that a threshold of 0 deletes all files immediately.\n   */\n  #[Test]\n  public function testDeleteAllWithZeroThreshold(): void {\n    // Override settings.\n    $settings = Settings::getAll();\n    $settings['asset_gc_threshold'] = 0;\n    new Settings($settings);\n\n    $directory = 'public://js';\n    $this->fileSystem->prepareDirectory($directory, FileSystemInterface::CREATE_DIRECTORY);\n\n    $recent_file = $directory . '/recent.js';\n    file_put_contents($recent_file, 'console.log(\"test\");');\n    touch($this->fileSystem->realpath($recent_file), time());\n\n    $this->assetDumper->deleteAll('js');\n    $this->assertFileDoesNotExist($recent_file);\n  }\n\n}\n",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3557835"
  },
  {
    "title": "Fix deprecated #access values in SDC component render arrays",
    "prompt": "<h2>Problem/Motivation</h2>\n<p>In Drupal 11, the <code>#access</code> key in render arrays has been tightened. According to the change record <a href=\"https://www.drupal.org/node/3549344\">\"Using a #access value other than a boolean or an AccessResultInterface object is deprecated\"</a>, the value must now strictly be either an <code>AccessResultInterface</code> object or <code>FALSE</code>. The use of <code>TRUE</code>, integers, or other objects is now deprecated and will be removed in Drupal 12.</p>\n<p>The custom module <code>sdc_access_fix</code> provides a Single Directory Component (SDC) called <code>info_box</code>. The controller <code>SdcController</code> currently uses the integer <code>1</code> for the <code>#access</code> key when returning the component render array, which triggers a deprecation warning.</p>\n\n<h2>Proposed resolution</h2>\n<p>Update <code>Drupal\\sdc_access_fix\\Controller\\SdcController</code> to use <code>\\Drupal\\Core\\Access\\AccessResult::allowed()</code> instead of the integer value <code>1</code>.</p>\n\n<h2>Remaining tasks</h2>\n<ul>\n  <li>Modify the controller to use the correct <code>AccessResult</code> object.</li>\n  <li>Ensure the component still renders correctly.</li>\n  <li>Verify that no deprecation warnings are triggered related to the <code>#access</code> key.</li>\n</ul>",
    "ground_truth": "--- a/web/modules/custom/sdc_access_fix/src/Controller/SdcController.php\n+++ b/web/modules/custom/sdc_access_fix/src/Controller/SdcController.php\n@@ -2,6 +2,7 @@\n \n namespace Drupal\\sdc_access_fix\\Controller;\n \n+use Drupal\\Core\\Access\\AccessResult;\n use Drupal\\Core\\Controller\\ControllerBase;\n \n /**\n@@ -18,7 +19,7 @@\n     return [\n       '#type' => 'component',\n       '#component' => 'sdc_access_fix:info_box',\n-      '#access' => 1,\n+      '#access' => AccessResult::allowed(),\n       '#configuration' => [\n         'message' => $this->t('This is a modern SDC component.'),\n       ],\n",
    "test_path": "web/modules/custom/sdc_access_fix/tests/src/Kernel/SdcAccessDeprecationTest.php",
    "test_content": "<?php\n\nnamespace Drupal\\Tests\\sdc_access_fix\\Kernel;\n\nuse Drupal\\Core\\Access\\AccessResultInterface;\n\nuse Drupal\\KernelTests\\KernelTestBase;\nuse Drupal\\sdc_access_fix\\Controller\\SdcController;\n\n/**\n * Tests that the SDC controller uses a valid #access value.\n *\n * @group sdc_access_fix\n */\nclass SdcAccessDeprecationTest extends KernelTestBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static $modules = ['system', 'sdc', 'sdc_access_fix', 'user'];\n\n  /**\n   * Tests the controller render array access property.\n   */\n  public function testControllerAccessValue(): void {\n    $controller = SdcController::create($this->container);\n    $render_array = $controller->renderComponent();\n\n    // Verify that #access is an instance of AccessResultInterface.\n    $this->assertInstanceOf(AccessResultInterface::class, $render_array['#access']);\n    $this->assertTrue($render_array['#access']->isAllowed());\n\n    // Verify the component type and ID.\n    $this->assertEquals('component', $render_array['#type']);\n    $this->assertEquals('sdc_access_fix:info_box', $render_array['#component']);\n\n    // Ensure the renderer can process it without errors.\n    $renderer = $this->container->get('renderer');\n    $output = $renderer->renderRoot($render_array);\n    $this->assertNotEmpty($output);\n  }\n\n}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3549344"
  },
  {
    "title": "Update Product Review Recipe to align with Drupal 11 text field standards",
    "prompt": "<h3>Problem/Motivation</h3><p>In Drupal 11, the Standard profile and core recipes have been updated to no longer use the <code>text_with_summary</code> field type for body-like fields. Instead, they now use <code>text_long</code>. This change simplifies the user interface by removing the summary field which is often unused or confusing for basic content types. Following the change record <a href='https://www.drupal.org/node/3569941'>Standard profile and recipes no longer use text_with_summary widget</a>, we need to update our custom 'Product Review' recipe to align with these modern standards.</p><h3>Proposed resolution</h3><p>Update the <code>product_review_content</code> recipe to:</p><ul><li>Change the field storage type of <code>field_review_body</code> from <code>text_with_summary</code> to <code>text_long</code>.</li><li>Update the field instance configuration to reflect the type change.</li><li>Change the form display widget from <code>text_textarea_with_summary</code> to <code>text_textarea</code>.</li><li>Change the view display formatter from <code>text_summary_or_trimmed</code> to <code>text_trimmed</code>.</li></ul><h3>Remaining tasks</h3><p>Modify the YAML configuration files within the recipe and verify the changes with a Kernel test.</p>",
    "ground_truth": "diff --git a/web/recipes/custom/product_review_content/config/core.entity_form_display.node.product_review.default.yml b/web/recipes/custom/product_review_content/config/core.entity_form_display.node.product_review.default.yml\nindex 1111111..2222222 100\n--- a/web/recipes/custom/product_review_content/config/core.entity_form_display.node.product_review.default.yml\n+++ b/web/recipes/custom/product_review_content/config/core.entity_form_display.node.product_review.default.yml\n@@ -15,7 +15,7 @@ content:\n     weight: 1\n     region: content\n     settings:\n-      rows: 9\n-      summary_rows: 3\n+      rows: 5\n       placeholder: ''\n-    third_party_settings: { }\n-    type: text_textarea_with_summary\n+    third_party_settings: {}\n+    type: text_textarea\ndiff --git a/web/recipes/custom/product_review_content/config/core.entity_view_display.node.product_review.default.yml b/web/recipes/custom/product_review_content/config/core.entity_view_display.node.product_review.default.yml\nindex 3333333..4444444 100\n--- a/web/recipes/custom/product_review_content/config/core.entity_view_display.node.product_review.default.yml\n+++ b/web/recipes/custom/product_review_content/config/core.entity_view_display.node.product_review.default.yml\n@@ -13,7 +13,7 @@ content:\n     label: hidden\n     settings:\n       trim_length: 600\n-    third_party_settings: { }\n-    type: text_summary_or_trimmed\n+    third_party_settings: {}\n+    type: text_trimmed\n     weight: 1\n     region: content\ndiff --git a/web/recipes/custom/product_review_content/config/field.field.node.product_review.field_review_body.yml b/web/recipes/custom/product_review_content/config/field.field.node.product_review.field_review_body.yml\nindex 5555555..6666666 100\n--- a/web/recipes/custom/product_review_content/config/field.field.node.product_review.field_review_body.yml\n+++ b/web/recipes/custom/product_review_content/config/field.field.node.product_review.field_review_body.yml\n@@ -11,4 +11,4 @@ description: 'The body of the product review.'\n required: false\n translucent: false\n bundle: product_review\n-field_type: text_with_summary\n+field_type: text_long\ndiff --git a/web/recipes/custom/product_review_content/config/field.storage.node.field_review_body.yml b/web/recipes/custom/product_review_content/config/field.storage.node.field_review_body.yml\nindex 7777777..8888888 100\n--- a/web/recipes/custom/product_review_content/config/field.storage.node.field_review_body.yml\n+++ b/web/recipes/custom/product_review_content/config/field.storage.node.field_review_body.yml\n@@ -3,7 +3,7 @@ langcode: en\n status: true\n dependencies:\n   module:\n-    - text\n+    - node\n     - user\n id: node.field_review_body\n entity_type: node\n-type: text_with_summary\n+type: text_long\n settings: { }\n module: text\n locked: false\n",
    "test_path": "web/core/tests/Drupal/KernelTests/Recipes/ProductReviewRecipeTest.php",
    "test_content": "<?php\n\nnamespace Drupal\\KernelTests\\Recipes;\n\nuse Drupal\\Core\\Recipe\\RecipeRunner;\n\n/**\n * Tests that the Product Review recipe uses modern text field configurations.\n *\n * @group Recipes\n */\nclass ProductReviewRecipeTest extends RecipeTestBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static $modules = [\n    'node',\n    'text',\n    'user',\n    'system',\n    'field',\n    'filter',\n  ];\n\n  /**\n   * Tests the recipe application and field config.\n   */\n  public function testRecipeApplication(): void {\n    // Path to our custom recipe.\n    $recipe_path = 'recipes/custom/product_review_content';\n    \n    // Create the recipe directory if it doesn't exist in the virtual file system \n    // or ensure the test runner can locate it. \n    // For this benchmarking task, we assume the recipe is present in the filesystem.\n\n    $this->applyRecipe($recipe_path);\n\n    // Check field storage.\n    $field_storage = \\Drupal::entityTypeManager()\n      ->getStorage('field_storage_config')\n      ->load('node.field_review_body');\n    $this->assertEquals('text_long', $field_storage->getType());\n\n    // Check field instance.\n    $field_instance = \\Drupal::entityTypeManager()\n      ->getStorage('field_config')\n      ->load('node.product_review.field_review_body');\n    $this->assertEquals('text_long', $field_instance->getType());\n\n    // Check form display.\n    $form_display = \\Drupal::entityTypeManager()\n      ->getStorage('entity_form_display')\n      ->load('node.product_review.default');\n    $component = $form_display->getComponent('field_review_body');\n    $this->assertEquals('text_textarea', $component['type']);\n    $this->assertArrayNotHasKey('summary_rows', $component['settings']);\n\n    // Check view display.\n    $view_display = \\Drupal::entityTypeManager()\n      ->getStorage('entity_view_display')\n      ->load('node.product_review.default');\n    $component = $view_display->getComponent('field_review_body');\n    $this->assertEquals('text_trimmed', $component['type']);\n  }\n\n  /**\n   * Helper to apply recipe.\n   */\n  protected function applyRecipe(string $path): void {\n    $recipe = \\Drupal\\Core\\Recipe\\Recipe::createFromDirectory($path);\n    RecipeRunner::processRecipe($recipe);\n  }\n}\n",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3569941"
  },
  {
    "title": "Refactor Comment anonymous contact settings to use AnonymousContact enum and PHPUnit 10",
    "prompt": "<h3>Problem/Motivation</h3><p>The <code>CommentInterface::ANONYMOUS_*</code> constants have been deprecated in Drupal 11 in favor of the <code>\\Drupal\\comment\\AnonymousContact</code> enum. Our custom module <code>comment_modernizer</code> provides a service to help determine messaging for anonymous commenters, but it currently relies on the deprecated integer constants. Additionally, the module's test suite needs to be modernized for PHPUnit 10/11 standards, including the use of PHP 8.3 attributes.</p><h3>Proposed resolution</h3><ul><li>Update <code>CommentSettingsHelper::isContactRequired()</code> and <code>CommentSettingsHelper::getSettingLabel()</code> to accept and process the <code>\\Drupal\\comment\\AnonymousContact</code> enum instead of <code>int</code>.</li><li>Refactor the associated Unit test to use PHPUnit 10 attributes (<code>#[Test]</code>, <code>#[DataProvider]</code>) and ensure strict typing.</li></ul><h3>Remaining tasks</h3><ol><li>Modify <code>web/modules/custom/comment_modernizer/src/CommentSettingsHelper.php</code> to replace constant usage with Enums.</li><li>Modify <code>web/modules/custom/comment_modernizer/tests/src/Unit/CommentSettingsHelperTest.php</code> to match the new signature and PHPUnit 10 requirements.</li></ol>",
    "ground_truth": "--- a/web/modules/custom/comment_modernizer/src/CommentSettingsHelper.php\n+++ b/web/modules/custom/comment_modernizer/src/CommentSettingsHelper.php\n@@ -2,12 +2,12 @@\n \n namespace Drupal\\comment_modernizer;\n \n-use Drupal\\comment\\CommentInterface;\n+use Drupal\\comment\\AnonymousContact;\n \n class CommentSettingsHelper {\n \n-  public function isContactRequired(int $setting): bool {\n-    return $setting === CommentInterface::ANONYMOUS_MUST_CONTACT;\n+  public function isContactRequired(AnonymousContact $setting): bool {\n+    return $setting === AnonymousContact::Required;\n   }\n \n-  public function getSettingLabel(int $setting): string {\n-    return match ($setting) {\n-      CommentInterface::ANONYMOUS_MAYNOT_CONTACT => 'Forbidden',\n-      CommentInterface::ANONYMOUS_MAY_CONTACT => 'Allowed',\n-      CommentInterface::ANONYMOUS_MUST_CONTACT => 'Required',\n-      default => 'Unknown',\n-    };\n+  public function getSettingLabel(AnonymousContact $setting): string {\n+    return $setting->label();\n   }\n-\n }",
    "test_path": "web/modules/custom/comment_modernizer/tests/src/Unit/CommentSettingsHelperTest.php",
    "test_content": "<?php\n\nnamespace Drupal\\Tests\\comment_modernizer\\Unit;\n\nuse Drupal\\comment\\AnonymousContact;\nuse Drupal\\comment_modernizer\\CommentSettingsHelper;\nuse Drupal\\Tests\\UnitTestCase;\nuse PHPUnit\\Framework\\Attributes\\DataProvider;\nuse PHPUnit\\Framework\\Attributes\\Test;\n\n/**\n * @coversDefaultClass \\Drupal\\comment_modernizer\\CommentSettingsHelper\n * @group comment_modernizer\n */\nclass CommentSettingsHelperTest extends UnitTestCase {\n\n  private CommentSettingsHelper $helper;\n\n  protected function setUp(): void {\n    parent::setUp();\n    $this->helper = new CommentSettingsHelper();\n  }\n\n  #[Test]\n  #[DataProvider('providerTestIsContactRequired')]\n  public function testIsContactRequired(AnonymousContact $setting, bool $expected): void {\n    $this->assertEquals($expected, $this->helper->isContactRequired($setting));\n  }\n\n  public static function providerTestIsContactRequired(): array {\n    return [\n      'forbidden' => [AnonymousContact::Forbidden, FALSE],\n      'allowed' => [AnonymousContact::Allowed, FALSE],\n      'required' => [AnonymousContact::Required, TRUE],\n    ];\n  }\n\n  #[Test]\n  #[DataProvider('providerTestGetSettingLabel')]\n  public function testGetSettingLabel(AnonymousContact $setting, string $expected): void {\n    $this->assertEquals($expected, $this->helper->getSettingLabel($setting));\n  }\n\n  public static function providerTestGetSettingLabel(): array {\n    return [\n      'forbidden label' => [AnonymousContact::Forbidden, 'Forbidden'],\n      'allowed label' => [AnonymousContact::Allowed, 'Allowed'],\n      'required label' => [AnonymousContact::Required, 'Required'],\n    ];\n  }\n\n}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3547352"
  },
  {
    "title": "Modernize Comment Preview Logic and Migration to PHPUnit 10",
    "prompt": "<h2>Problem/Motivation</h2>\n<p>As per the Drupal 11 change record <a href=\"https://www.drupal.org/node/3566882\">https://www.drupal.org/node/3566882</a>, the procedural <code>comment_preview()</code> function has been deprecated. Its logic has been moved into the <code>CommentForm::preview()</code> method. Custom modules using this function must be refactored to use the form object's preview method.</p>\n<p>Additionally, as part of the Drupal 11 development cycle, our custom tests must be updated to comply with PHPUnit 10+ standards, specifically replacing PHPDoc annotations with PHP 8.3 attributes.</p>\n\n<h2>Proposed resolution</h2>\n<ul>\n  <li>Update <code>CommentPreviewManager::getPreviewBuild()</code> in the <code>comment_modernizer</code> module to stop using the deprecated <code>comment_preview()</code> function.</li>\n  <li>Utilize the <code>entity_type.manager</code> to retrieve the comment form object and invoke its <code>preview()</code> method.</li>\n  <li>Refactor the associated Kernel test to use <code>#[Test]</code> and <code>#[Group]</code> attributes instead of <code>@test</code> and <code>@group</code>.</li>\n</ul>\n\n<h2>Remaining tasks</h2>\n<ol>\n  <li>Apply the code changes to the service.</li>\n  <li>Refactor the test file to PHPUnit 10 standards.</li>\n  <li>Verify the test passes under Drupal 11.</li>\n</ol>",
    "ground_truth": "diff --git a/web/modules/custom/comment_modernizer/src/CommentPreviewManager.php b/web/modules/custom/comment_modernizer/src/CommentPreviewManager.php\nindex a1b2c3d..e4f5g6h 100644\n--- a/web/modules/custom/comment_modernizer/src/CommentPreviewManager.php\n+++ b/web/modules/custom/comment_modernizer/src/CommentPreviewManager.php\n@@ -2,10 +2,13 @@\n \n namespace Drupal\\comment_modernizer;\n \n+use Drupal\\Core\\Entity\\EntityTypeManagerInterface;\n+use Drupal\\Core\\Form\\FormState;\n use Drupal\\comment\\CommentInterface;\n \n class CommentPreviewManager {\n \n+  public function __construct(protected EntityTypeManagerInterface $entityTypeManager) {}\n+\n   /**\n    * Generates a preview build for a comment.\n    *\n@@ -15,6 +18,10 @@ class CommentPreviewManager {\n    *   A render array for the comment preview.\n    */\n   public function getPreviewBuild(CommentInterface $comment): array {\n-    return comment_preview($comment);\n+    /** @var \\Drupal\\comment\\CommentFormInterface $form_object */\n+    $form_object = $this->entityTypeManager->getFormObject('comment', 'default');\n+    $form_object->setEntity($comment);\n+    $form_state = new FormState();\n+    return $form_object->preview([], $form_state);\n   }\n }\ndiff --git a/web/modules/custom/comment_modernizer/tests/src/Kernel/CommentPreviewTest.php b/web/modules/custom/comment_modernizer/tests/src/Kernel/CommentPreviewTest.php\nindex b1c2d3e..f4g5h6i 100644\n--- a/web/modules/custom/comment_modernizer/tests/src/Kernel/CommentPreviewTest.php\n+++ b/web/modules/custom/comment_modernizer/tests/src/Kernel/CommentPreviewTest.php\n@@ -4,11 +4,13 @@ namespace Drupal\\Tests\\comment_modernizer\\Kernel;\n \n use Drupal\\comment\\Entity\\Comment;\n use Drupal\\KernelTests\\KernelTestBase;\n+use PHPUnit\\Framework\\Attributes\\Test;\n+use PHPUnit\\Framework\\Attributes\\Group;\n \n /**\n  * Tests the comment preview modernization.\n- *\n- * @group comment_modernizer\n  */\n+#[Group('comment_modernizer')]\n class CommentPreviewTest extends KernelTestBase {\n \n   protected static $modules = ['comment', 'user', 'system', 'comment_modernizer'];\n@@ -25,10 +27,9 @@ class CommentPreviewTest extends KernelTestBase {\n   /**\n    * Tests that the preview manager returns a render array.\n    *\n-   * @test\n    */\n+  #[Test]\n   public function testPreviewGeneration(): void {\n-    $manager = $this->container->get('comment_modernizer.preview_manager');\n+    $manager = \\Drupal::service('comment_modernizer.preview_manager');\n     $comment = Comment::create([\n       'comment_type' => 'comment',\n       'subject' => 'Test comment',",
    "test_path": "web/modules/custom/comment_modernizer/tests/src/Kernel/CommentPreviewTest.php",
    "test_content": "<?php\n\nnamespace Drupal\\Tests\\comment_modernizer\\Kernel;\n\nuse Drupal\\comment\\Entity\\Comment;\n\nuse Drupal\\comment\\Entity\\CommentType;\nuse Drupal\\KernelTests\\KernelTestBase;\nuse PHPUnit\\Framework\\Attributes\\Test;\nuse PHPUnit\\Framework\\Attributes\\Group;\n\n/**\n * Tests the comment preview modernization.\n */\n#[Group('comment_modernizer')]\nclass CommentPreviewTest extends KernelTestBase {\n\n  protected static $modules = ['comment', 'user', 'system', 'field', 'comment_modernizer'];\n\n  protected function setUp(): void {\n    parent::setUp();\n    $this->installEntitySchema('comment');\n    $this->installEntitySchema('user');\n    $this->installConfig(['comment']);\n\n    CommentType::create([\n      'id' => 'comment',\n      'label' => 'Comment',\n      'target_entity_type_id' => 'node',\n    ])->save();\n  }\n\n  /**\n   * Tests that the preview manager returns a render array.\n   */\n  #[Test]\n  public function testPreviewGeneration(): void {\n    $manager = $this->container->get('comment_modernizer.preview_manager');\n    $comment = Comment::create([\n      'comment_type' => 'comment',\n      'subject' => 'Test comment',\n      'comment_body' => 'This is a test comment',\n    ]);\n\n    $build = $manager->getPreviewBuild($comment);\n\n    $this->assertIsArray($build);\n    // In Drupal 11 CommentForm::preview returns a render array with 'comment_preview'.\n    $this->assertEquals('comment', $build['#theme'] ?? 'comment');\n    $this->assertEquals('Test comment', $build['#comment']->getSubject());\n  }\n\n}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3566882"
  },
  {
    "title": "Migrate deprecated History module permissions to Access Policy API",
    "prompt": "<h2>Problem/Motivation</h2>\n<p>The core <strong>History</strong> module is deprecated in Drupal 11 and will be removed in Drupal 12. As part of our site's migration to Drupal 11, we are replacing the core history tracking with a custom internal system. However, we need a way to dynamically grant access to history data based on a user's profile settings rather than static roles.</p>\n<p>The goal is to use the new <strong>Access Policy API</strong> to grant a custom permission <code>view custom history</code> only if the user has a boolean field <code>field_enable_history</code> set to <code>true</code>.</p>\n\n<h2>Proposed resolution</h2>\n<p>Create a new module <code>history_access_migrator</code> that implements an <code>AccessPolicyInterface</code>.</p>\n<ul>\n  <li>The policy should apply to the <code>SCOPE_DRUPAL</code> scope.</li>\n  <li>The <code>calculatePermissions</code> method should check if the user is authenticated and if their <code>field_enable_history</code> field is checked.</li>\n  <li>If both conditions are met, grant the <code>view custom history</code> permission.</li>\n  <li>Ensure the cache contexts are correctly set to <code>user</code> to handle per-user field values.</li>\n</ul>\n\n<h2>Remaining tasks</h2>\n<ul>\n  <li>Implement <code>history_access_migrator.info.yml</code>.</li>\n  <li>Define the service with the <code>access_policy</code> tag in <code>history_access_migrator.services.yml</code>.</li>\n  <li>Create <code>Drupal\\history_access_migrator\\Access\\HistoryAccessPolicy</code>.</li>\n  <li>Write a Kernel test to verify that the permission is correctly granted based on the user field value.</li>\n</ul>",
    "ground_truth": "diff --git a/web/modules/custom/history_access_migrator/history_access_migrator.info.yml b/web/modules/custom/history_access_migrator/history_access_migrator.info.yml\nnew file mode 100644\n--- /dev/null\n+++ b/web/modules/custom/history_access_migrator/history_access_migrator.info.yml\n@@ -0,0 +1,7 @@\n+name: 'History Access Migrator'\n+type: module\n+description: 'Provides an access policy for node history.'\n+core_version_requirement: ^11\n+package: Custom\n+dependencies:\n+  - drupal:user\ndiff --git a/web/modules/custom/history_access_migrator/history_access_migrator.services.yml b/web/modules/custom/history_access_migrator/history_access_migrator.services.yml\nnew file mode 100644\n--- /dev/null\n+++ b/web/modules/custom/history_access_migrator/history_access_migrator.services.yml\n@@ -0,0 +1,5 @@\n+services:\n+  history_access_migrator.access_policy:\n+    class: Drupal\\history_access_migrator\\Access\\HistoryAccessPolicy\n+    tags:\n+      - { name: access_policy }\ndiff --git a/web/modules/custom/history_access_migrator/src/Access/HistoryAccessPolicy.php b/web/modules/custom/history_access_migrator/src/Access/HistoryAccessPolicy.php\nnew file mode 100644\n--- /dev/null\n+++ b/web/modules/custom/history_access_migrator/src/Access/HistoryAccessPolicy.php\n@@ -0,0 +1,41 @@\n+<?php\n+\n+namespace Drupal\\history_access_migrator\\Access;\n+\n+use Drupal\\Core\\Access\\AccessPolicyInterface;\n+use Drupal\\Core\\Access\\CalculatedPermissionsInterface;\n+use Drupal\\Core\\Access\\CalculatedPermissionsItem;\n+use Drupal\\Core\\Access\\RefinableCalculatedPermissions;\n+use Drupal\\Core\\Session\\AccountInterface;\n+use Drupal\\user\\Entity\\User;\n+\n+/**\n+ * Access policy for history access.\n+ */\n+class HistoryAccessPolicy implements AccessPolicyInterface {\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function applies(string $scope): bool {\n+    return $scope === AccessPolicyInterface::SCOPE_DRUPAL;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function calculatePermissions(AccountInterface $account, string $scope): CalculatedPermissionsInterface {\n+    $permissions = new RefinableCalculatedPermissions();\n+    $user = User::load($account->id());\n+    if ($user && $user->hasField('field_enable_history') && !empty($user->get('field_enable_history')->value)) {\n+      $permissions->addItem(new CalculatedPermissionsItem(permissions: ['view custom history']));\n+    }\n+    return $permissions;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function getPersistentCacheContexts(string $scope): array {\n+    return ['user'];\n+  }\n+}",
    "test_path": "web/modules/custom/history_access_migrator/tests/src/Kernel/HistoryAccessPolicyTest.php",
    "test_content": "<?php\n\nnamespace Drupal\\Tests\\history_access_migrator\\Kernel;\n\nuse Drupal\\field\\Entity\\FieldConfig;\nuse Drupal\\field\\Entity\\FieldStorageConfig;\nuse Drupal\\KernelTests\\KernelTestBase;\nuse Drupal\\user\\Entity\\User;\nuse PHPUnit\\Framework\\Attributes\\Test;\n\n/**\n * Tests the history access policy.\n *\n * @group history_access_migrator\n */\nclass HistoryAccessPolicyTest extends KernelTestBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static $modules = [\n    'system',\n    'user',\n    'field',\n    'history_access_migrator',\n  ];\n\n  /**\n   * {@inheritdoc}\n   */\n  protected function setUp(): void {\n    parent::setUp();\n\n    $this->installEntitySchema('user');\n\n    FieldStorageConfig::create([\n      'field_name' => 'field_enable_history',\n      'entity_type' => 'user',\n      'type' => 'boolean',\n    ])->save();\n\n    FieldConfig::create([\n      'field_name' => 'field_enable_history',\n      'entity_type' => 'user',\n      'bundle' => 'user',\n      'label' => 'Enable History',\n    ])->save();\n  }\n\n  /**\n   * Tests the calculatePermissions method.\n   */\n  #[Test]\n  public function testCalculatePermissions(): void {\n    /** @var \\Drupal\\Core\\Access\\AccessPolicyProcessorInterface $processor */\n    $processor = $this->container->get('access_policy.processor');\n\n    $user_with_access = User::create([\n      'name' => 'allowed',\n      'field_enable_history' => TRUE,\n    ]);\n    $user_with_access->save();\n\n    $user_without_access = User::create([\n      'name' => 'denied',\n      'field_enable_history' => FALSE,\n    ]);\n    $user_without_access->save();\n\n    $permissions_with = $processor->process($user_with_access);\n    $this->assertTrue($permissions_with->hasPermission('view custom history'), 'Permission should be granted when field is true.');\n\n    $permissions_without = $processor->process($user_without_access);\n    $this->assertFalse($permissions_without->hasPermission('view custom history'), 'Permission should not be granted when field is false.');\n  }\n\n}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3567647"
  },
  {
    "title": "Implement getSummary() for custom FieldTypeCategoryInterface implementations",
    "prompt": "<h3>Problem/Motivation</h3><p>With the release of Drupal 11.1, a new method <code>getSummary()</code> has been added to <code>Drupal\\Core\\Field\\FieldTypeCategoryInterface</code>. This method allows site builders to see a brief summary of a field category when creating new fields in the UI. Our custom module <code>media_helper</code> provides a custom implementation of this interface in the <code>MediaCategory</code> class and a YAML-based category definition. Currently, the module is causing fatal errors on Drupal 11.1 because the <code>MediaCategory</code> class does not implement the required <code>getSummary()</code> method.</p><h3>Proposed resolution</h3><ul><li>Update <code>\\Drupal\\media_helper\\MediaCategory</code> to implement <code>getSummary()</code>.</li><li>Update <code>media_helper.field_type_categories.yml</code> to include the <code>summary</code> key for the <code>advanced_media</code> category.</li></ul><h3>Remaining tasks</h3><ol><li>Implement the new method in the PHP class.</li><li>Update the YAML definition.</li><li>Ensure the summary is correctly returned by the Field Type Category Manager.</li></ol>",
    "ground_truth": "diff --git a/web/modules/custom/media_helper/media_helper.field_type_categories.yml b/web/modules/custom/media_helper/media_helper.field_type_categories.yml\nindex e69de29..b7d8c91 100\n--- a/web/modules/custom/media_helper/media_helper.field_type_categories.yml\n+++ b/web/modules/custom/media_helper/media_helper.field_type_categories.yml\n@@ -0,0 +1,5 @@\n+advanced_media:\n+  label: 'Advanced Media'\n+  description: 'Complex media types including remote streams.'\n+  summary: 'Provides high-performance media handling for remote assets and local streams.'\n+  weight: 10\ndiff --git a/web/modules/custom/media_helper/src/MediaCategory.php b/web/modules/custom/media_helper/src/MediaCategory.php\nindex e69de29..f4a8b22 100\n--- a/web/modules/custom/media_helper/src/MediaCategory.php\n+++ b/web/modules/custom/media_helper/src/MediaCategory.php\n@@ -0,0 +1,51 @@\n+<?php\n+\n+namespace Drupal\\media_helper;\n+\n+use Drupal\\Core\\Field\\FieldTypeCategoryInterface;\n+use Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n+\n+/**\n+ * A custom field type category implementation.\n+ */\n+class MediaCategory implements FieldTypeCategoryInterface {\n+\n+  public function __construct(\n+    protected string $id,\n+    protected TranslatableMarkup $label,\n+    protected TranslatableMarkup $description,\n+    protected TranslatableMarkup $summary,\n+    protected int $weight = 0,\n+    protected array $libraries = [],\n+  ) {}\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function getLabel(): TranslatableMarkup {\n+    return $this$label;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function getDescription(): TranslatableMarkup {\n+    return $this$description;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function getSummary(): TranslatableMarkup {\n+    return $this$summary;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function getWeight(): int {\n+    return $this$weight;\n+  }\n+\n+  /**\n+   * {@inheritdoc}\n+   */\n+  public function getLibraries(): array {\n+    return $this$libraries;\n+  }\n+\n+}",
    "test_path": "web/modules/custom/media_helper/tests/src/Kernel/FieldTypeCategorySummaryTest.php",
    "test_content": "<?php\n\nnamespace Drupal\\Tests\\media_helper\\Kernel;\n\n|use Drupal\\KernelTests\\KernelTestBase;\nuse Drupal\\media_helper\\MediaCategory;\nuse Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n\n/**\n * Tests the Field Type Category summary functionality.\n *\n * @group media_helper\n */\nclass FieldTypeCategorySummaryTest extends KernelTestBase {\n\n  /**\n   * {@inheritdoc}\n   */\n  protected static $modules = ['system', 'field', 'media_helper'];\n\n  /**\n   * Tests that the custom MediaCategory class implements getSummary().\n   */\n  public function testMediaCategoryClassSummary(): void {\n    $category = new MediaCategory(\n      'test_id',\n      new TranslatableMarkup('Label'),\n      new TranslatableMarkup('Description'),\n      new TranslatableMarkup('Summary Text'),\n      0\n    );\n\n    $this->assertInstanceOf(MediaCategory::class, $category);\n    $this->assertEquals('Summary Text', (string) $category->getSummary());\n  }\n\n  /**\n   * Tests that the YAML-defined category includes the summary.\n   */\n  public function testYamlCategorySummary(): void {\n    /** @var \\Drupal\\Core\\Field\\FieldTypeCategoryManagerInterface $manager */\n    $manager = $this->container->get('plugin.manager.field.field_type_category');\n    $categories = $manager->getDefinitions();\n\n    $this->assertArrayHasKey('advanced_media', $categories);\n    $this->assertEquals('Provides high-performance media handling for remote assets and local streams.', (string) $categories['advanced_media']['summary']);\n    \n    $category_instance = $manager->createInstance('advanced_media');\n    $this->assertEquals('Provides high-performance media handling for remote assets and local streams.', (string) $category_instance->getSummary());\n  }\n\n}",
    "version": "11.x",
    "source_url": "https://www.drupal.org/node/3526434"
  }
]